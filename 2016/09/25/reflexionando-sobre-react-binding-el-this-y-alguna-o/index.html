<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Estás últimas dos semanas he estado aprendiendo React para un pet project que tenemos entre mis compañeros Ronny y Modesto.
Tiramos lo que teníamos de">
    

    <!--Author-->
    
        <meta name="author" content="Miguel Ángel Viera">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="ES6 en React y resolviendo el binding del this"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Miguel Viera"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>ES6 en React y resolviendo el binding del this - Miguel Viera</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Miguel Viera</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/Groxalf">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/images/header.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>ES6 en React y resolviendo el binding del this</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2016-09-25
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        

<a href="/categories/React/">React</a>

                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <script src="/assets/js/DPlayer.min.js"> </script><p>Estás últimas dos semanas he estado aprendiendo React para un pet project que tenemos entre mis compañeros Ronny y Modesto.</p>
<p>Tiramos lo que teníamos de nuestra interfaz hecha con Polymer (que no era mucho tampoco) puesto que nos veíamos incapaces de avanzar de una forma constante ya que nos encontrábamos con problemas a cada momento que decidíamos sentarnos a programar.</p>
<p>Otra de las razones fue también que testear Polymer se nos hacía un poco complicado. Y no nos terminaba de encajar el modelo que Google propone para testear el comportamiento de tu componente empleando la librería de Node.js llamada web-component-tester. Lo malo es que al ejecutar los test, web-component-tester necesita lanzar una instancia de Webdriver para correr Google Chrome y probar la lógica que quieras probar. Esto nos complica también el hecho de que si quisieramos lanzar los test en un entorno de integración continua, no podríamos ni siquiera usando PhantomJS pues aún no soporta el estándar de Web Components en el que Polymer se basa.</p>
<p>Estas y varias otra razones (compatibilidad con múltiples navegadores, mayor cantidad de documentación y un maravilloso curso de introducción de Corey House en Pluralsight) nos hizo decantarnos por React.js para fabricar la interfaz web de nuestra aplicación.</p>
<p>Para este post quisiera hablar en concreto de dos decisiones que hemos tomado durante el desarrollo:</p>
<p>La primera es <em>usar ES6 en el proyecto</em>. Dado que no tiene mucho sentido seguir usando ES5 a día de hoy, puesto que ES6 es el estándar.</p>
<p>De entre varios de los approach que hemos seguido para crear componentes en React, al final hemos optado por emplear las clases de ES6. Aunque no nos parece una solución completamente limpia y nos gusta más el enfoque de usar únicamente funciones en Javascript, nos parece mejor que usar el React.createClass pasándole el objeto que contiene la definición de nuestras funciones dentro del componente o usar meramente composición, pues nos parecía demasiado esfuerzo el abstraernos de la librería para que al final fuera demasiado complejo entender el por qué lo hacíamos y cuanto ganábamos realmente con ello.</p>
<p><figure class="highlight javascript"><figcaption><span>&#125;<br>&#123;% codeblock lang:javascript</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</div><div class="line"><span class="keyword">import</span> &#123; Tabs, Tab &#125; <span class="keyword">from</span> <span class="string">'material-ui/Tabs'</span>;</div><div class="line"><span class="keyword">import</span> &#123; hashHistory &#125; <span class="keyword">from</span> <span class="string">'react-router'</span>;</div><div class="line"></div><div class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">NavigationBar</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">constructor</span>() &#123;</div><div class="line">        <span class="keyword">super</span>();</div><div class="line">        <span class="keyword">this</span>.state = &#123;</div><div class="line">            <span class="attr">value</span> : <span class="string">'home'</span></div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">        <span class="keyword">this</span>.setState(&#123;</div><div class="line">            <span class="attr">value</span>: value</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            &lt;Tabs value=&#123;this.state.value&#125; onChange=&#123;this.handleChange&#125;&gt;</div><div class="line">                &lt;Tab label="Home" value="home" /&gt;</div><div class="line">                &lt;Tab label="New Document" value="new-document" /&gt;</div><div class="line">            &lt;/Tabs&gt;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Aquí tenemos un ejemplo de componente que hemos creado con React. Como vemos es tan sencillo como crear una clase y extender de React.Component.</p>
<p>El optar por está decisión tiene varias implicaciones, lo cual nos lleva a nuestra segunda decisión. <em>Decidir es el mecanismo para hacer el binding del this</em> cuando la función this.handleChange  es pasada como callback al componente hijo.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">render() &#123;</div><div class="line">    <span class="keyword">return</span> (</div><div class="line">        &lt;div&gt;</div><div class="line">            &lt;Tabs value=&#123;this.state.value&#125; onChange=&#123;this.handleChange&#125;&gt;</div><div class="line">                &lt;Tab label="Home" value="home" /&gt;</div><div class="line">                &lt;Tab label="New Document" value="new-document" /&gt;</div><div class="line">            &lt;/Tabs&gt;</div><div class="line">        &lt;/div&gt;</div><div class="line">    );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Si nos fijamos en el render, al pasarle la función que tenemos declarada en nuestra clase al onChage lo que nos ocurre básicamente es que Javascript no liga el this que usa la función internamente al de la instancia de la clase que pasa esa función. Para resolver esta situación hemos encontrado diversas soluciones:</p>
<ul>
<li><strong>Usar el React.createClass</strong>. Si empleamos la función que nos provee React para crear componentes, esta internamente hará toda la magia por nosotros.<em>   <em>*Usar el bind</em></em> cuando pasemos nuestra función como callback al componente hijo: <em>“onChange={this.handleChange.bind(this)}”</em></li>
<li><strong>Pasarle un Arrow Function</strong> con la llamada al método en onChange: <em>“onChange={ value =&gt; { this.handleChange(value) }}</em></li>
<li><strong>Declarar handleChange dentro del constructor empleando un Arrow Function</strong></li>
</ul>
<p><figure class="highlight javascript"><figcaption><span>&#125;<br>&#123;% codeblock lang:javascript</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">constructor</span>() &#123;</div><div class="line">    <span class="keyword">super</span>();</div><div class="line">    <span class="keyword">this</span>.state = &#123;</div><div class="line">        <span class="attr">value</span> : <span class="string">'home'</span></div><div class="line">    &#125;;</div><div class="line">    <span class="keyword">this</span>.handleChange = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">            <span class="keyword">this</span>.setState(&#123;value&#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Estas son las cuatro maneras más sencillas en las que resolver nuestro problema sin tener que recurrir a mecanismos externos. Sin embargo, a ninguno nos gustaba estas soluciones, y en caso de tener que adoptar por alguna de las tres últimas, preferimos optar por emplear React.createClass.</p>
<p>Buscando otras formas de resolver este problema, encontramos un mecanismo que está por implementar en la siguiente especificación del lenguaje (ES2016), que básicamente es el <strong>emplear un decorador de función</strong> para que te haga el binding automáticamente empleando la librería “autobind-decorator” disponible en NPM. El resultado final sería algo tal que así:</p>
<p><figure class="highlight javascript"><figcaption><span>&#125;<br>&#123;% codeblock lang:javascript</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@autobind</div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleChange</span>(<span class="params">value</span>) </span>&#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">value</span>: value</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">&lt;Tabs value=&#123;this.state.value&#125; onChange=&#123;this.handleChange&#125;&gt;</div></pre></td></tr></table></figure></p>
<p>Esta opción tampoco nos acababa de convencer, <strong>dado que tenemos que estar importando en cada componente la librería de autobind</strong> y no nos parece un solución lo suficientemente limpia como para tenerla en consideración. Una cosa a tener en cuenta para usar este mecanismo, es que en caso de estar usando Babel 6 para transpilar, hagas uso también del preset “babel-plugin-transform-decorators-legacy” para que funcione adecuadamente (todo está explicando en su Github de todas maneras).</p>
<p>La última y opción por la que finalmente hemos optado. Es <strong>emplear un Arrow Function en una propiedad de la clase</strong>. El problema con el que nos encontramos al usar esta solución, es que la especificación actual del lenguaje no soporta esta característica. Hay dos formas de lograr que funcione. La primera es usar el plugin de Babel “transform-class-properties” y la segunda sería establecer el preset “stage-2” de Babel instalando “babel-preset-stage-2” en NPM. Al final, todo quedaría de la siguiente forma:</p>
<p><figure class="highlight javascript"><figcaption><span>&#125;<br>&#123;% codeblock lang:javascript</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">handleChange = <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</div><div class="line">    <span class="keyword">this</span>.setState(&#123;</div><div class="line">        <span class="attr">value</span>: value</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line">&lt;Tabs value=&#123;this.state.value&#125; onChange=&#123;this.handleChange&#125;&gt;</div></pre></td></tr></table></figure></p>
<p>Un último apunte que se nos da al usar esta solución y el autobind, es que dado que nosotros usamos eslint, tenemos el problema de que tenemos que configurarlo para que soporte ambas features. Para arreglarlo, basta con únicamente usar como parser del eslinter “babel-eslint” y añadir en nuestro .babelrc lo siguiente:</p>
<p><figure class="highlight javascript"><figcaption><span>&#125;<br>&#123;% codeblock lang:javascript</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"parser"</span>: <span class="string">"babel-eslint"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Y listo, con eso, ya estaría todo solucionado.</p>
<p>Básicamente, así quedaría todo. Esta alternativa es desde nuestro punto de vista, la que menor ruido genera, y a nivel de legibilidad, la más simple. Y al final, un Arrow Function adopta el binding del this en el enclosing scope, por lo que todo se hace forma automática y se asemeja a lo que ya estamos acostumbrados en ES6.</p>
<p>Cualquier clase de feedback será bien recibido y por aquí dejo unos enlaces que pudieran ser de interés. Un saludo!</p>
<ul>
<li><a href="http://app.pluralsight.com/author/cory-house" target="_blank" rel="external">Perfil PluralSight Corey House</a></li>
<li><a href="https://medium.com/@housecor/react-binding-patterns-5-approaches-for-handling-this-92c651b5af56#.mwn7jh38i" target="_blank" rel="external">React Binding Patterns: 5 Approaches for Handling <code>this</code></a></li>
</ul>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://twitter.com/Groxalf_Esp" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="https://github.com/Groxalf" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>