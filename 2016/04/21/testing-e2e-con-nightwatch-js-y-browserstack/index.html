<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Desde hace un par de meses, he estado trabajando en el desarrollo de una librería que integra una plataforma de pagos en la web de los clientes que ne">
    

    <!--Author-->
    
        <meta name="author" content="Miguel Ángel Viera">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Testing E2E con Nightwatch.js y Browserstack"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Miguel Viera"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

        <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>Testing E2E con Nightwatch.js y Browserstack - Miguel Viera</title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    


</head>


<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Miguel Viera</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/archives">
                            
                                Archives
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="https://github.com/Groxalf">
                            
                                <i class="fa fa-github fa-stack-2x"></i>
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-image: url('/images/header.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Testing E2E con Nightwatch.js y Browserstack</h1>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                        2016-04-21
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Tags and categories -->
           
                <div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags">
                    
                        


<a href="/tags/Javascript/">#Javascript</a> <a href="/tags/Browserstack/">#Browserstack</a> <a href="/tags/Tests-E2E/">#Tests E2E</a> <a href="/tags/Webdriver/">#Webdriver</a> <a href="/tags/Nightwatch/">#Nightwatch</a>


                    
                </div>
                <div class="col-lg-4 col-md-5 post-categories">
                    
                        

<a href="/categories/Uncategorized/">Uncategorized</a>

                    
                </div>
            

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <script src="/assets/js/DPlayer.min.js"> </script><p>Desde hace un par de meses, he estado trabajando en el desarrollo de una librería que integra una plataforma de pagos en la web de los clientes que necesitan un intermediario que se encargue de los pagos de los productos de los consumidores de dicha web.</p>
<p>Uno de los requisitos necesarios en el desarrollo consiste en que la librería debe ser compatible con múltiples navegadores y versiones antiguas de los mismos. Y dado este requisito surgió la necesidad de utilizar algún sistema que nos permitiera ejecutar rápidamente una batería de test End To End contra muchos navegadores que no requiriera de tener que instalarlos en nuestros propios equipos empleando un servidor Selenium local que se encargara de la ejecución automática de los mismos.</p>
<p>Pero antes de hablar de la plataforma que empleamos para enfrentar este problema, es mejor tratar primero con la herramienta que empleamos para ejecutar este tipo de test. En un principio decidimos emplear la librería para Node.js que provee la API del Webdriver de Selenium, por motivos de como se construyen los elementos dentro del DOM, estos tests quedaban muy poco amigables y de difícil comprensión. Así que optamos por buscar una alternativa que hicieran nuestros tests mucho más Reading Friendly y fue cuando descubrimos <a href="http://nightwatchjs.org/" target="_blank" rel="external">Nightwatch.js</a>, una librería de tests E2E que emplea el WebDriver de Selenium Under the Hood, pero que ofrece una API muy simple e intuitiva. En la propia web sirven muy buenos ejemplos, aunque propondré una pequeña guía de como lo hemos montado.</p>
<p>Lo primero, es descargarse un standalone de <a href="http://www.seleniumhq.org/download/" target="_blank" rel="external">Selenium</a><br>Creamos un proyecto de node e instalamos la librería de nightwatch:</p>
<p><code>npm install --save nightwatch</code></p>
<p>Creamos un fichero un fichero <strong><em>nightwatch.json</em></strong>  en nuestro root folder del proyecto y copiar este código:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"src_folders"</span> : [<span class="string">"tests"</span>],</div><div class="line"></div><div class="line">    <span class="string">"selenium"</span> : &#123;</div><div class="line">        <span class="string">"start_process"</span> : <span class="literal">false</span>,</div><div class="line">        <span class="string">"host"</span> : <span class="string">"127.0.0.1"</span>,</div><div class="line">        <span class="string">"port"</span> : <span class="number">4444</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="string">"test_settings"</span> : &#123;</div><div class="line">        <span class="string">"default"</span> : &#123;</div><div class="line">              <span class="string">"launch_url"</span> : <span class="string">"http://localhost"</span>,</div><div class="line">              <span class="string">"selenium_port"</span>  : <span class="number">4444</span>,</div><div class="line">              <span class="string">"selenium_host"</span>  : <span class="string">"localhost"</span>,</div><div class="line">              <span class="string">"silent"</span>: <span class="literal">true</span>,</div><div class="line">              <span class="string">"desiredCapabilities"</span>: &#123;</div><div class="line">                    <span class="string">"browserName"</span>: <span class="string">"firefox"</span>,</div><div class="line">                    <span class="string">"javascriptEnabled"</span>: <span class="literal">true</span>,</div><div class="line">                    <span class="string">"acceptSslCerts"</span>: <span class="literal">true</span></div><div class="line">              &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Con esta configuración, estamos indicando a Nightwatch que la configuración para que ejecute los tests sean en un servidor local de Selenium y que abra una instancia del navegador Firefox. Que los tests se encuentran en la carpeta “tests” del root folder y que Firefox, es el navegador por defecto para lanzar los tests si no se especifica el entorno o environment.</p>
<p>Creamos la carpeta tests y creamos un fichero javascript, que en mi caso, es <strong><em>sampleTest.js</em></strong> . Y el código de test es el siguiente.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="string">'Sample test'</span> : <span class="function"><span class="keyword">function</span> (<span class="params">browser</span>) </span>&#123;</div><div class="line">    browser</div><div class="line">      .url(<span class="string">'http://www.google.com'</span>)</div><div class="line">      .waitForElementVisible(<span class="string">'body'</span>, <span class="number">1000</span>)</div><div class="line">      .setValue(<span class="string">'input[type=text]'</span>, <span class="string">'nightwatch'</span>)</div><div class="line">      .waitForElementVisible(<span class="string">'button[name=btnG]'</span>, <span class="number">1000</span>)</div><div class="line">      .click(<span class="string">'button[name=btnG]'</span>)</div><div class="line">      .pause(<span class="number">1000</span>)</div><div class="line">      .assert.containsText(<span class="string">'#main'</span>, <span class="string">'Night Watch'</span>)</div><div class="line">      .end();</div><div class="line">  &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>Como se puede observar, es un simple test que tira contra la web de Google, espera que el elemento body del DOM aparezca, introduce un valor en el campo de texto, envía el formulario de búsqueda de la página principal y espera a que carguen los resultados para luego buscar el texto Night Watch dentro del DOM nuevo generado por la web.</p>
<p>Con todo esto, estamos listos para correr los tests en nuestro Firefox local.<br>Levantamos nuestro servidor standalone de Selenium:</p>
<p><code>java -jar selenium-server-standalone-2.53.0.jar</code></p>
<p>Y corremos nuestros tests:</p>
<p><code>./node_modules/.bin/nightwatch</code></p>
<p>Y si todo ha ido bien, debería abrirse nuestro navegador Firefox automáticamente y ejecutar la tarea descrita anteriormente.  Rápido y sencillo.</p>
<p>Pero la magia no termina aquí. Como mencioné anteriormente, la intención con la que decidimos hacer este tipo de test, era para probar distintos navegadores sin la necesidad de instalarlos en nuestros equipos. Y es aquí donde entra en partida <a href="https://www.browserstack.com/" target="_blank" rel="external">BrowserStack</a>. BrowserStack es un servicio que te provee de un catálogo de navegadores de más de 700 con distintas  versiones, en distintos sistemas operativos (móviles, escritorio) para probar tu web tanto de forma manual como automática y aunque podría dar para mucho hablar lo que se puede hacer con esta plataforma, me voy a enfocar en lanzar el test E2E que hemos realizado en distintos navegadores a través de ella.</p>
<p>Para ello vamos a crear otro fichero nuevo de configuración de Nightwatch, donde esta vez, en vez de establecer que la instancia de Selenium es local, es la que te provee Browserstack en su guía de uso de Automate tests en su web. Además configuraremos dos entornos, uno que será Firefox en la versión 26.0 en Windows XP y Chrome en la versión 35.0 en OS X El Capitán. El fichero (al que he llamado <strong><em>browserstack.json</em></strong>) pues, contrendría algo así:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="string">"src_folders"</span> : [<span class="string">"tests"</span>],</div><div class="line"></div><div class="line">    <span class="string">"selenium"</span> : &#123;</div><div class="line">        <span class="string">"start_process"</span> : <span class="literal">false</span>,</div><div class="line">        <span class="string">"host"</span> : <span class="string">"hub.browserstack.com"</span>,</div><div class="line">        <span class="string">"port"</span> : <span class="number">80</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="string">"test_settings"</span> : &#123;</div><div class="line">        <span class="string">"firefox-windowsXP"</span> : &#123;</div><div class="line">            <span class="string">"launch_url"</span> : <span class="string">"http://hub.browserstack.com"</span>,</div><div class="line">            <span class="string">"selenium_port"</span>  : <span class="number">80</span>,</div><div class="line">            <span class="string">"selenium_host"</span>  : <span class="string">"hub.browserstack.com"</span>,</div><div class="line">            <span class="string">"silent"</span>: <span class="literal">true</span>,</div><div class="line">            <span class="string">"screenshots"</span> : &#123;</div><div class="line">                <span class="string">"enabled"</span> : <span class="literal">false</span>,</div><div class="line">                <span class="string">"path"</span> : <span class="string">""</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">"desiredCapabilities"</span>: &#123;</div><div class="line">                <span class="string">"browser"</span> : <span class="string">"Firefox"</span>,</div><div class="line">                <span class="string">"browser_version"</span> : <span class="string">"26.0"</span>,</div><div class="line">                <span class="string">"os"</span> : <span class="string">"Windows"</span>,</div><div class="line">                <span class="string">"os_version"</span> : <span class="string">"XP"</span>,</div><div class="line">                <span class="string">"resolution"</span> : <span class="string">"1024x768"</span>,</div><div class="line">                <span class="string">"browserstack.user"</span>: <span class="string">"sampletest5"</span>,</div><div class="line">                <span class="string">"browserstack.key"</span>: <span class="string">"whpcwHc2znQeTrn1XsHZ"</span></div><div class="line">            &#125;</div><div class="line">        &#125;,</div><div class="line">        <span class="string">"chrome-elcapitan"</span> : &#123;</div><div class="line">            <span class="string">"launch_url"</span> : <span class="string">"http://hub.browserstack.com"</span>,</div><div class="line">            <span class="string">"selenium_port"</span>  : <span class="number">80</span>,</div><div class="line">            <span class="string">"selenium_host"</span>  : <span class="string">"hub.browserstack.com"</span>,</div><div class="line">            <span class="string">"silent"</span>: <span class="literal">true</span>,</div><div class="line">            <span class="string">"screenshots"</span> : &#123;</div><div class="line">                <span class="string">"enabled"</span> : <span class="literal">false</span>,</div><div class="line">                <span class="string">"path"</span> : <span class="string">""</span></div><div class="line">            &#125;,</div><div class="line">            <span class="string">"desiredCapabilities"</span>: &#123;</div><div class="line">                <span class="string">"browser"</span> : <span class="string">"Chrome"</span>,</div><div class="line">                <span class="string">"browser_version"</span> : <span class="string">"35.0"</span>,</div><div class="line">                <span class="string">"os"</span> : <span class="string">"OS X"</span>,</div><div class="line">                <span class="string">"os_version"</span> : <span class="string">"El Capitan"</span>,</div><div class="line">                <span class="string">"resolution"</span> : <span class="string">"1024x768"</span>,</div><div class="line">                <span class="string">"javascriptEnabled"</span>: <span class="literal">true</span>,</div><div class="line">                <span class="string">"browserstack.user"</span>: <span class="string">"sampletest5"</span>,</div><div class="line">                <span class="string">"browserstack.key"</span>: <span class="string">"whpcwHc2znQeTrn1XsHZ"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Nótese, que en este caso, en _test<em>settings</em> hemos eliminado default, por lo que al ejecutar Nightwatch pasándole este fichero de configuración en vez del que hemos creado con anterioridad (el que usa Nightwatch si no se le indica lo contrario) no ejecutará ningún test si no se le indica que entorno es. Las keys “browserstack.user” y “browserstack.key” se obtienen al registrar una cuenta en la plataforma y meterte en el apartado Automate, para este pequeño ejemplo, he creado una cuenta para la demostración.</p>
<p>Si todo ha ido bien hasta ahora, al ejecutar Nightwatch, pasándole este fichero de configuración y estableciéndole los entornos sobre los que correr el test, debería usar BrowserStack.</p>
<p><code>./node_modules/.bin/nightwatch -c ./browserstack -e firefox-windowsXP,chrome-elcapitan</code></p>
<p>Y el resultado debería ser algo parecido a esto.</p>
<p><img src="/images/testing-e2e/result.png" alt=""></p>
<p>Y por último, una de las mejores features que nos da Browserstack, es que podemos ver la ejecución de estos tests en un vídeo que suben a la plataforma en la misma sección Automate. Aquí se listan todos los tests que se han ejecutado en esta cuenta y te enseña, además un log  y un vídeo de cada uno de ellos para ver como ha ido la ejecución, y como se ha formado la web en ese navegador durante el test. Aquí los ejemplos de este post.</p>
<div id="dplayer0" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer0 = new DPlayer({"element":document.getElementById("dplayer0"),"video":{"url":"/videos/testing-e2e/chrome-mac.mp4"}});</script>
<div id="dplayer1" class="dplayer" style="margin-bottom: 20px;"></div><script>var dplayer1 = new DPlayer({"element":document.getElementById("dplayer1"),"video":{"url":"/videos/testing-e2e/firefox-xp.mp4"}});</script>
<p>Bueno, y eso es todo. Una cosa más que comentar, es que existe un plugin de gulp para lanzar las tareas de Nightwatch automáticamente que nosotros tenemos configurado para que tire de todos los entornos que tenemos configurados en el fichero de configuración de BrowserStack.</p>
<p>Existen muchas otras opciones realmente interesantes en esta plataforma que no he llegado a probar porque aún no ha surgido la necesidad. Pero si alguien se anima a probarlas y dejarme algún comentario de qué le ha parecido (como por ejemplo: sacar screenshots del proceso de testing y descarlas vía API de BrowserStack y demás cosas de este estilo) sería una genial contribución.</p>
<p>Un saludo y muchas gracias por leerme. Cualquier comentario será bien recibido :D</p>
<p>P.D: Este es el repositorio de GitHub que contiene todo el proceso del post. Espero que sea de ayuda. <a href="https://github.com/Groxalf/NightwatchJSBrowserStackSample" target="_blank" rel="external">Repositorio</a></p>


                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    


                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://twitter.com/Groxalf_Esp" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="https://github.com/Groxalf" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    
                </ul>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->



</body>

</html>